<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>SQL Grammar</title>
</head>
<body>
<div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_SVG_Hidden"></div><svg><defs id="MathJax_SVG_glyphs"><path id="MJMAIN-F7" stroke-width="1" d="M318 466Q318 500 339 518T386 537Q418 537 438 517T458 466Q458 438 440 417T388 396Q355 396 337 417T318 466ZM56 237T56 250T70 270H706Q721 262 721 250T706 230H70Q56 237 56 250ZM318 34Q318 68 339 86T386 105Q418 105 438 85T458 34Q458 6 440 -15T388 -36Q355 -36 337 -15T318 34Z"></path></defs></svg></div><div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="ayc3" id="sql-grammar">SQL Grammar</h1><p data-anchor-id="x2u2"><code>programming_language</code></p><div class="md-section-divider"></div><h2 data-anchor-id="pnpe" id="conventions">conventions</h2><p data-anchor-id="v78d">tuple: a row in a table  <br>
relation: a table consisting of several tuples <br>
database: several relations</p><div class="md-section-divider"></div><h2 data-anchor-id="l2en" id="relation-algebra-fundation">relation algebra fundation</h2><p data-anchor-id="4ltq">select, project, union, difference, Cartesian-product, rename <br>
Union: the two relations must follow the same features and their domain won't conflict. </p><p data-anchor-id="2stk">supplyment: </p><ul data-anchor-id="2w87">
<li>intersection</li>
<li>natural join: do Cartesian-product and selct the tuples with the same values on features from both the two relations.  </li>
<li>division: A<span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" role="textbox" aria-readonly="true" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 -558.0516853480245 778.5 615.103370696049" style="width: 1.853ex; height: 1.39ex; vertical-align: -0.232ex; margin: 1px 0px;"><g stroke="black" fill="black" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMAIN-F7"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1">\div</script>B include all features in A but not in B</li>
<li>assignment: temp &lt;- operation expression </li>
</ul><p data-anchor-id="tpws">expand relation algebra</p><ul data-anchor-id="6efl">
<li>generalized-projection: use arithmatic operations in projection</li>
<li>aggregating function: sum, count, min, max</li>
<li>outer-join: make up the quitted values to avoid info lose (left/right/full outer-join)</li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="cmhd" id="basic-data-type">basic data type</h2><ul data-anchor-id="q6xs">
<li>char(n)  fixed length </li>
<li>varchar(n)</li>
<li>int</li>
<li>smallint</li>
<li>numeric(p,q)  有效数字，小数点位置从右到左</li>
<li>real</li>
<li>double </li>
<li>float(n)</li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="11mp" id="basic-operations">basic operations</h2><div class="md-section-divider"></div><h3 data-anchor-id="4ggf" id="create-a-tablerelation">create a table/relation</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="tax2" style=""><ol class="linenums"><li class="L0"><code><span class="pln">create table </span><span class="str">&lt;table_name&gt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">attr1 data_type</span><span class="pun">,...</span><span class="pln"> </span><span class="pun">,</span></code></li><li class="L1"><code><span class="pln">primary key</span><span class="pun">(</span><span class="pln">attrs</span><span class="pun">),</span><span class="pln"> foreign key</span><span class="pun">(</span><span class="pln">attr</span><span class="pun">)</span><span class="pln"> another_table</span><span class="pun">)</span></code></li></ol></pre><p data-anchor-id="15gp">prime key is unique and not null <br>
foreign key is a reference to other table. </p><div class="md-section-divider"></div><h3 data-anchor-id="zb09" id="select-from-where">select, from, where</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="uxga" style=""><ol class="linenums"><li class="L0"><code><span class="kwd">select</span><span class="pln"> </span><span class="str">&lt;attrbutes&gt;</span><span class="pun">----</span><span class="pln">projection</span></code></li><li class="L1"><code><span class="kwd">from</span><span class="pln"> </span><span class="str">&lt;relations&gt;</span><span class="pln"> </span><span class="pun">-----</span><span class="pln"> </span><span class="typ">Cartesian</span><span class="pun">-</span><span class="pln">product</span></code></li><li class="L2"><code><span class="kwd">where</span><span class="pln"> </span><span class="str">&lt;predicates&gt;</span><span class="pln"> </span><span class="pun">-----</span><span class="pln">selection predicate</span></code></li></ol></pre><p data-anchor-id="jmqo">SQL returns a relation</p><p data-anchor-id="taxe"><code>select *</code> means to select all attributes. <br>
<code>select distinct</code> means to eliminate duplicates  <br>
<code>select all</code> means not to do that <br>
<code>name as T</code> used to set an alias</p><div class="md-section-divider"></div><h3 data-anchor-id="u4bf" id="insertion">insertion</h3><p data-anchor-id="ll1m">add a tuple to a table  <br>
<code>insert into &lt;table_name&gt; values(attr1 val1, attre2 val2...)</code> <br>
all attributes follow the order in the definition. <br>
If you forget the order, use this: <br>
<code>insert into &lt;table_name&gt;(attr1,atr2,...) values(val1,val2...)</code></p><p data-anchor-id="w7lc">add an attribute to a table  <br>
<code>alter table &lt;table_name&gt; add &lt;attribute&gt; &lt;domain&gt;</code>  </p><p data-anchor-id="fuch">how to insert in batches? <br>
One way to insert several tuples is: <br>
<code>insert into &lt;table_name&gt; select ... from ... where ...</code></p><div class="md-section-divider"></div><h3 data-anchor-id="pd2c" id="delete">delete</h3><p data-anchor-id="blzy">Note: delete clause only applies to ONE relation. <br>
clear all tuples from the relation <br>
<code>delete from &lt;table_name&gt;</code> <br>
delete the table from the database <br>
<code>drop table &lt;table_name&gt;</code> <br>
delete an attribute from a table  <br>
<code>alter table &lt;table_name&gt; drop &lt;attribute&gt;</code> </p><div class="md-section-divider"></div><h3 data-anchor-id="xk2g" id="join">join</h3><p data-anchor-id="pf7h"><code>&lt;table_name1&gt; natural join &lt;table_name2&gt;</code>  <br>
Natural join returns tuples with the same value on the same attributes of both realtions.</p><p data-anchor-id="2aq8"><code>&lt;table1&gt; join &lt;table2&gt; using(&lt;attr1&gt;,&lt;attr2&gt;...)</code> <br>
join tuples from two relations with the same values on the given attributes.</p><div class="md-section-divider"></div><h3 data-anchor-id="t4hr" id="set-order">set order</h3><p data-anchor-id="k8aa"><code>order by &lt;attr&gt; desc/asc</code> ascend default</p><div class="md-section-divider"></div><h3 data-anchor-id="j5a0" id="string-matching">string matching</h3><p data-anchor-id="qch3"><code>where &lt;attr&gt; like '%abc%d_'</code> <br>
<code>%</code> matches any string <br>
<code>_</code> matches a single char <br>
<code>escape '/'</code> means <code>/%</code> is just a <code>%</code></p><div class="md-section-divider"></div><h3 data-anchor-id="ojmr" id="set-operations">set operations</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="fwq9" style=""><ol class="linenums"><li class="L0"><code><span class="pun">(</span><span class="kwd">select</span><span class="pln"> A </span><span class="kwd">from</span><span class="pln"> B</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">union</span><span class="pun">/</span><span class="pln">intersect</span><span class="pun">/</span><span class="kwd">except</span><span class="pln"> </span><span class="pun">(</span><span class="pln">all</span><span class="pun">)</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">select</span><span class="pln"> C </span><span class="kwd">from</span><span class="pln"> D</span><span class="pun">)</span></code></li></ol></pre><p data-anchor-id="642d">union, intersect, except abandon dupllicates automatically</p><p data-anchor-id="2els">### aggregating functions  <br>
<code>avg  min max sum  count</code> <br>
<code>group by &lt;attr&gt;</code> construct groups according to features to which aggregating functions apply <br>
<code>having &lt;predicates&gt;</code> predicates apply to groups generated by <code>group by</code> </p><p data-anchor-id="ui9x">If there are both <code>where</code> and <code>having</code> subsentence in a query, SQL culculates predicates in <code>where</code> first and forms groups according to  <code>group by</code>, before applying <code>having</code>. Groups not fitting <code>having</code> predicates will be abandaned and the left return to <code>select</code> as result.</p><div class="md-section-divider"></div><h3 data-anchor-id="pq31" id="useful-components">useful components</h3><div class="md-section-divider"></div><h4 data-anchor-id="tljm" id="detect-null">detect null</h4><p data-anchor-id="qftw"><code>is null</code> / <code>is not null</code> / </p><div class="md-section-divider"></div><h4 data-anchor-id="p5k8" id="check-whether-a-tuple-is-in-the-relation">check whether a tuple is in the relation</h4><p data-anchor-id="cgp9"><code>&lt;tuple&gt; in &lt;relation&gt;</code> <br>
<code>not in</code></p><div class="md-section-divider"></div><h4 data-anchor-id="l67h" id="check-an-empty-relation">check an empty relation</h4><p data-anchor-id="olyx"><code>exsists</code></p><div class="md-section-divider"></div><h4 data-anchor-id="lla4" id="compare">compare</h4><p data-anchor-id="utg6"><code>some</code> at least one  <br>
<code>all</code> for all </p><div class="md-section-divider"></div><h4 data-anchor-id="ktk4" id="between-and">between ... and ...</h4><p data-anchor-id="327g">describe numeric range</p><div class="md-section-divider"></div><h3 data-anchor-id="i6fl" id="with-clause">with clause</h3><p data-anchor-id="x2t2">decomposite the complicated query by defining temporary tiny view </p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="r8w8" style=""><ol class="linenums"><li class="L0"><code><span class="kwd">with</span><span class="pln"> tempo_view</span><span class="pun">(</span><span class="pln">attr1</span><span class="pun">,</span><span class="pln">attr2</span><span class="pun">...)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">select</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span></code></li><li class="L2"><code><span class="kwd">select</span><span class="pln"> </span><span class="pun">...</span></code></li><li class="L3"><code><span class="kwd">from</span><span class="pln"> tempo_view</span></code></li><li class="L4"><code><span class="kwd">where</span><span class="pln"> </span><span class="pun">...</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="850p" id="update">update</h3><p data-anchor-id="i8ry">change the value of some features without changing the whole tuple.</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="6hg4" style=""><ol class="linenums"><li class="L0"><code><span class="pln">update </span><span class="str">&lt;table_name&gt;</span></code></li><li class="L1"><code><span class="kwd">set</span><span class="pln"> </span><span class="str">&lt;old_attr&gt;</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">&lt;new_attr&gt;</span></code></li><li class="L2"><code><span class="kwd">where</span><span class="pln"> </span><span class="pun">...</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="s78n" id="case-clause">case clause</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="a9ch" style=""><ol class="linenums"><li class="L0"><code><span class="kwd">case</span><span class="pln"> </span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">when</span><span class="pln"> </span><span class="str">&lt;pred1&gt;</span><span class="pln"> </span><span class="kwd">then</span><span class="pln"> </span><span class="str">&lt;result1&gt;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">when</span><span class="pln"> </span><span class="str">&lt;pred2&gt;</span><span class="pln"> </span><span class="kwd">then</span><span class="pln"> </span><span class="str">&lt;result2&gt;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">...</span></code></li><li class="L4"><code><span class="pln">    eles </span><span class="str">&lt;result0&gt;</span></code></li><li class="L5"><code><span class="kwd">end</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="9lag" id="advanced-operations">Advanced operations</h2><div class="md-section-divider"></div><h3 data-anchor-id="it7n" id="grant">grant</h3><p data-anchor-id="e5ag"><code>grant &lt;operations&gt; on &lt;attributes&gt; to &lt;users&gt; (with grant option)</code> <br>
authorize other users with centain operations (including the operation to autherize) <br>
<code>revoke &lt;operations&gt; on &lt;attributes&gt; to &lt;users&gt;</code> <br>
take back that authorization</p><div class="md-section-divider"></div><h3 data-anchor-id="5klz" id="integrity-constrain">integrity constrain</h3><p data-anchor-id="wcxg">in case of data destruction</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="sspf" style=""><ol class="linenums"><li class="L0"><code><span class="pln">create table </span><span class="str">&lt;table_name&gt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">attr1 data_type</span><span class="pun">,...</span><span class="pln"> </span><span class="pun">,</span></code></li><li class="L1"><code><span class="pln">primary key</span><span class="pun">(</span><span class="pln">attrs</span><span class="pun">),</span><span class="pln"> </span></code></li><li class="L2"><code><span class="pln">foreign key</span><span class="pun">(</span><span class="pln">attr</span><span class="pun">)</span><span class="pln"> another_table</span></code></li><li class="L3"><code><span class="pln">check</span><span class="pun">(</span><span class="pln">attr1 </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">val1</span><span class="pun">,</span><span class="pln">val2</span><span class="pun">,</span><span class="pln">val3</span><span class="pun">...))</span></code></li><li class="L4"><code><span class="pun">)</span></code></li></ol></pre><p data-anchor-id="hdzz">the value of attribute1 must be among the given values. </p><div class="md-section-divider"></div><h3 data-anchor-id="ggen" id="transaction">transaction</h3><p data-anchor-id="vbok">A transaction consists of query expressions and update expressions. <br>
When a SQL clause was excuted, a transaction started.  <br>
The following clause end a transaction: <br>
<code>commit work</code> (submit the update made by SQL above and automatically start a new transaction) <br>
or  <br>
<code>rollback work</code></p><div class="md-section-divider"></div><h3 data-anchor-id="mzds" id="view">view</h3><p data-anchor-id="mqmv">view is not actual logic model but a virtual relation shown to users.</p><ul data-anchor-id="kn4u">
<li>create a view <br>
<code>create view &lt;name&gt; as &lt;query expression&gt;</code> <br>
query expression means "select from where" clause. <br>
We can explicitly indicate the features of the view <br>
<code>create view &lt;name&gt;(attr1,attr2...) as &lt;query expression&gt;</code> <br>
The database system stores the definition of the view rather than the result of the query expression of the view.</li>
</ul><p data-anchor-id="ldzp">More: mateiralized view &amp; view maintenance. </p><div class="md-section-divider"></div><h3 data-anchor-id="jlin" id="linkage-relations">linkage relations</h3><p data-anchor-id="9m1e"><code>inner join</code>  <br>
<code>left outer join</code> <br>
<code>natural right outer join</code> <br>
<code>full outer join</code></p><div class="md-section-divider"></div><h3 data-anchor-id="3akh" id="hackerrank-experience">HackerRank Experience</h3><ul data-anchor-id="ayl9">
<li>count minus <br>
<code>select count(city)-(select count(distinct city) from table) from table</code></li>
</ul></div>
</body>
</html>